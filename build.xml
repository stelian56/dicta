<?xml version="1.0"?>
<!-- Dicta build script -->

<project name="geocentral.net.dicta" default="all">
 
  <property name="app.name" value="Dicta"/>
  <property name="app.version" value="1.0"/>
  <property name="build.dir" value="build"/>
  <property name="test.dir" value="test"/>
  <property name="package.dir" value="package"/>
  
  <target name="clean">
    <delete dir="${build.dir}"/>
    <delete dir="${test.dir}"/>
    <delete dir="${package.dir}"/>
  </target>

  <target name="test" depends="testbrowser,testdotnet"/>

  <target name="testbrowser">
    <copy todir="${test.dir}/browser">
      <fileset dir="${basedir}" includes="css/**"/>
      <fileset dir="bin" includes="**"/>
      <fileset dir="html" includes="**"/>
      <fileset dir="${basedir}" includes="sample/**"/>
    </copy>
    <copy todir="${test.dir}/browser/js">
      <fileset dir="js" excludes="dicta.js test.js optimize.js lib/r.js *.js.func"/>
    </copy>
  </target>
  
  <target name="testdotnet">
    <copy todir="${test.dir}">
      <fileset dir="${basedir}" includes="dotnet/**"/>
    </copy>
    <copy todir="${test.dir}/dotnet/DictaWPF/edge/js">
      <fileset dir="js" includes="**/*" excludes="
        dicta.js test.js optimize.js *.js.func test/**
      "/>
    </copy>
    <copy todir="${test.dir}/dotnet/DictaTest/edge/js">
      <fileset dir="js" includes="**/*" excludes="
        dicta.js test.js optimize.js query.js.func
      "/>
    </copy>
    <copy todir="${test.dir}/dotnet/DictaTest/sample">
      <fileset dir="${basedir}/sample" includes="**" excludes="ui.dicta"/>
    </copy>
    <copy todir="${test.dir}/dotnet/SampleWPFApplication/edge/js">
      <fileset dir="js" includes="**/*" excludes="
        dicta.js optimize.js test.js.func lib/jquery* lib/require* test/**
      "/>
    </copy>
    <copy todir="${test.dir}/dotnet/SampleWPFApplication/sample">
      <fileset dir="${basedir}/sample" includes="ui.dicta"/>
    </copy>
  </target>
  
  <target name="package" depends="packagebrowser,packagedotnet"/>
  
  <target name="packagebrowser">
  <copy todir="${build.dir}" file="js/lib/r.js"/>
    <copy todir="${build.dir}/dicta/js">
      <fileset dir="js" includes="**/*" excludes="dicta.js lib/r.js test/**"/>
    </copy>
    <copy todir="${build.dir}/dicta">
      <fileset dir="js" includes="dicta.js"/>
    </copy>
    <copy todir="${build.dir}/dicta">
      <fileset dir="js/lib" includes="require*.js"/>
      <globmapper from="require*.js" to="require.js"/>
    </copy>
    <exec executable="cmd" dir="${build.dir}/dicta/js">
      <arg value="/c"/>
      <arg value="node"/>
      <arg value="optimize.js"/>
    </exec>
    <mkdir dir="${package.dir}"/>
    <copy todir="${package.dir}/browser/js">
      <fileset dir="${build.dir}/release" includes="dicta.js"/>
    </copy>
    <copy todir="${package.dir}/node/js">
      <fileset dir="js" includes="**/*" excludes="
          dicta.js
          optimize.js
          test/ui.js
          lib/jquery*.js
          lib/require*.js
      "/>
    </copy>
  </target>
  
  <target name="packagedotnet"/>
  
  <target name="all" depends="clean,package,test"/>

</project>


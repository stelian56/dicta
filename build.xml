<?xml version="1.0"?>
<!-- Dicta build script -->

<project name="geocentral.net.dicta" default="all">
 
  <property name="app.name" value="Dicta"/>
  <property name="app.version" value="1.0"/>
  <property name="build.dir" value="build"/>
  <property name="test.dir" value="test"/>
  <property name="package.dir" value="package"/>
  
  <target name="clean">
    <delete dir="${build.dir}"/>
    <delete dir="${test.dir}"/>
    <delete dir="${package.dir}"/>
  </target>

  <target name="test">
    <copy todir="${test.dir}">
      <fileset dir="${basedir}" includes="css/**"/>
      <fileset dir="bin" includes="**"/>
      <fileset dir="html" includes="**"/>
    </copy>
    <copy todir="${test.dir}/js">
      <fileset dir="js" excludes="dicta.js dicta.build.js lib/r.js"/>
    </copy>
    <copy todir="${test.dir}">
      <fileset dir="${basedir}" includes="sample/**"/>
    </copy>
  </target>
    
  <target name="package">
  <copy todir="${build.dir}" file="js/lib/r.js"/>
    <copy todir="${build.dir}/dicta/js">
      <fileset dir="js" includes="**/*" excludes="dicta.js lib/r.js test/**"/>
    </copy>
    <copy todir="${build.dir}/dicta">
      <fileset dir="js" includes="dicta.js"/>
    </copy>
    <copy todir="${build.dir}/dicta">
      <fileset dir="js/lib" includes="require*.js"/>
      <globmapper from="require*.js" to="require.js"/>
    </copy>
    <exec executable="cmd" dir="${build.dir}/dicta/js">
      <arg value="/c"/>
      <arg value="node"/>
      <arg value="../../r.js"/>
      <arg value="-o"/>
      <arg value="dicta.build.js"/>
    </exec>
    <mkdir dir="${package.dir}"/>
    <tstamp/>
    <copy todir="${package.dir}/js">
      <fileset dir="${build.dir}/release" includes="dicta.js"/>
      <globmapper from="*.js" to="*-${app.version}.${DSTAMP}.js"/>
    </copy>
  </target>
  
  <target name="all" depends="clean,package,test"/>

</project>

